-- View: public.country_level_event_merged_geospatial_data_viz

-- DROP MATERIALIZED VIEW IF EXISTS public.country_level_event_merged_geospatial_data_viz;

CREATE MATERIALIZED VIEW IF NOT EXISTS public.country_level_event_merged_geospatial_data_viz
TABLESPACE pg_default
AS
 SELECT COALESCE(g.gid, e."ISO3 (GADM - GID)"::character varying) AS "ISO3 (GADM - GID)",
    COALESCE(g.admin_level, NULL::integer) AS "Admin Level",
    COALESCE(g.date, e."Date") AS "Date",
    g."Daily Average Temperature of Air (2m)",
    g."Daily Total Evaporation",
    g."Daily Maximun Temperature of Air (2m)",
    g."Daily Minimun Temperature of Air (2m)",
    g."Daily Total Surface Net Solar Radiation",
    g."Daily Total Precipitation",
    g."Percentage of Employed Men in Lower Nonfarm Jobs",
    g."Infant Mortality Rate (per 1000 live births)",
    g."Yearly Average Relative Humidity",
    g."Yearly Average Surface Temperature (C)",
    g."Yearly Total Precipitation",
    g."Population Percentage Age 0-9",
    g."Population Percentage Age 10-19",
    g."Population Percentage Age 20-29",
    g."Population Percentage Age 30-39",
    g."Population Percentage Age 40-49",
    g."Population Percentage Age 50-59",
    g."Population Percentage Age 60-69",
    g."Population Percentage Age 70-79",
    g."Population Percentage Age 80-89",
    g."Population Percentage Age 90+",
    g."Partners Avg Age Difference ",
    g."Avg Age at First Marriage (Women 20-50)",
    g."BMI for Age Z-Score",
    g."Percentage of Households with a Cellphone",
    g."Percentage of 1 year olds with DTP3 Vaccine",
    g."Mean Years Education (Adults 25+)",
    g."Percentage of Households with Electricity",
    g."Percentage of Employed Men in Agriculture",
    g."Height for Age Z-score",
    g."Average Household Size",
    g."Percentage of Employed Men in Upper Nonfarm Jobs",
    g."Percentage of Households with Internet",
    g."International Wealth Index Score (IWI)",
    g."Percentage of Poorest Households (IWI Value under 35)",
    g."Percentage of Poorest Households (IWI Value under 50)",
    g."Percentage of Poorest Households (IWI Value under 70)",
    g."Percentage of 1 year olds with Measles Vaccine",
    g."Average Years of Educations (Men 25+)",
    g."Percentage of households with Piped Water",
    g."Percentage of Regional Population Aged 65+",
    g."Percentage Share of National Population",
    g."Percentage of Regional Population Aged 15-65",
    g."Total Area Population",
    g."Percentage of Stunted Children (0-59 months)",
    g."Total Fertility Rate",
    g."Wealth Inequality between Groups",
    g."Wealth Inequality within Groups",
    g."Under 5 Mortality Rate",
    g."Percentage of Urban Population",
    g."Percentage of Employed Women in Agriculture",
    g."Weight for Age Z-Score",
    g."Weight for Height Z-Score",
    g."Average Years of Education (Women 25+)",
    g."Percentage of Women in Paid Employment",
    g."Percentage of Women Employed in Upper Nonfarm Jobs",
    g."Percentage of Women Employed in Lower Nonfarm Jobs",
    g."Educational Index",
    g."Educational Index - Female",
    g."Educational Index - Male",
    g."Health Index",
    g."Health Index - Female",
    g."Health Index - Male",
    g."Income Index",
    g."Log Gross National Income Per Capita ",
    g."Life Expectancy",
    g."Life Expectancy (Female)",
    g."Life Expectancy (Male)",
    g."GDL - Population Count (pop)",
    g."Subnational Gender Development Index (SGDI)",
    g."Subnational Human Development Index (SHDI)",
    g."Subnational Human Development Index (SHDI) - Female",
    g."Subnational Human Development Index (SHDI) - Male",
    g."Monthly Total Burnt Area",
    g."Root-zone Soil Moisture",
    g."Conflict Internal Displacements",
    g."Conflict Total Displacement",
    g."Disaster Internal Displacements",
    g."Disaster Total Displacement",
    g."Conflict Displacements Both Sexes Age 0-4",
    g."Conflict Displacements Both Sexes Age 5-11",
    g."Conflict Displacements Both Sexes Age 12-17",
    g."Conflict Displacements Both Sexes Age 18-59",
    g."Conflict Displacements Both Sexes Age 60+",
    g."Conflict Displacements Female Age 0-4",
    g."Conflict Displacements Female Age 5-11",
    g."Conflict Displacements Female Age 12-17",
    g."Conflict Displacements Female Age 18-59",
    g."Conflict Displacements Female Age 60+",
    g."Conflict Displacements Male Age 0-4",
    g."Conflict Displacements Male Age 5-11",
    g."Conflict Displacements Male Age 12-17",
    g."Conflict Displacements Male Age 18-59",
    g."Conflict Displacements Male 60+",
    g."Disaster Displacements Both Sexes 0-4",
    g."Disaster Displacements Both Sexes 5-11",
    g."Disaster Displacements Both Sexes 12-17",
    g."Disaster Displacements Both Sexes 18-59",
    g."Disaster Displacements Both Sexes 60+",
    g."Disaster Displacements Female 0-4",
    g."Disaster Displacements Female 5-11",
    g."Disaster Displacements Female 12-17",
    g."Disaster Displacements Female 18-59",
    g."Disaster Displacements Female 60+",
    g."Disaster Displacements Male 0-4",
    g."Disaster Displacements Male 5-11",
    g."Disaster Displacements Male 12-17",
    g."Disaster Displacements Male 18-59",
    g."Disaster Displacements Male 60+",
    g."Land Class - Rainfed Cropland Tree or Shrub Cover",
    g."Land Class - No Data",
    g."Land Class - Mosaic Tree and Shrub",
    g."Land Class - Rainfed Cropland",
    g."Land Class - Mosaic Herbaceous",
    g."Land Class - Rainfed Cropland Herbaceous Cover",
    g."Land Class - Shrubland",
    g."Land Class - Evergreen Shrubland",
    g."Land Class - Deciduous Shrubland",
    g."Land Class - Grassland",
    g."Land Class - Lichens and Mosses",
    g."Land Class - Sparse Vegetation",
    g."Land Class - Sparse Tree",
    g."Land Class - Sparse Shrub",
    g."Land Class - Sparse Herbaceous",
    g."Land Class - Flooded Fresh or Brackish Water Tree Cover",
    g."Land Class - Flooded Saline Water Tree Cover",
    g."Land Class - Flooded Shrub or Herbaceous Cover",
    g."Land Class - Urban",
    g."Land Class - Bare Areas",
    g."Land Class - Consolidated Bare Areas",
    g."Land Class - Unconsolidated Bare Areas",
    g."Land Class - Irrigated Cropland",
    g."Land Class - Water",
    g."Land Class - Snow and Ice",
    g."Land Class - Mosaic Cropland",
    g."Land Class - Mosaic Natural Vegetation",
    g."Land Class - Broadleaved Evergreen Tree Closed to Open",
    g."Land Class - Broadleaved Deciduous Tree Closed to Open",
    g."Land Class - Broadleaved Deciduous Tree Closed",
    g."Land Class - Broadleaved Decisuous Tree Open",
    g."Land Class - Needleleaved Evergreen Tree Closed to Open",
    g."Land Class - Needleleaved Evergreen Tree Closed",
    g."Land Class - Needleleaved Evergreen Tree Open",
    g."Land Class - Needleleaved Deciduous Tree Closed to Open",
    g."Land Class - Needleleaved Deciduous Tree Closed",
    g."Land Class - Needleleaved Deciduous Tree Open",
    g."Land Class - Mixed Tree",
    g."Daily Average Dust Surface Mass Concentration - PM 2.5",
    g."Daily Average Organic Carbon Surface Mass Concentration",
    g."Daily Average Black Carbon Surface Mass Concentration",
    g."Normalized Difference Vegetation Index",
    g."WorldPop - Population Count",
    g."WorldPop - Population Density",
    g."Total Female Population Age <1",
    g."Total Female Population Age 1-4",
    g."Total Female Population Age 5-9",
    g."Total Female Population Age 10-14",
    g."Total Female Population Age 15-19",
    g."Total Female Population Age 20-24",
    g."Total Female Population Age 25-29",
    g."Total Female Population Age 30-34",
    g."Total Female Population Age 35-39",
    g."Total Female Population Age 40-44",
    g."Total Female Population Age 45-49",
    g."Total Female Population Age 50-54",
    g."Total Female Population Age 55-59",
    g."Total Female Population Age 60-64",
    g."Total Female Population Age 65-69",
    g."Total Female Population Age 70-74",
    g."Total Female Population Age 75-79",
    g."Total Female Population Age 80+",
    g."Total Male Population Age <1",
    g."Total Male Population Age 1-4",
    g."Total Male Population Age 5-9",
    g."Total Male Population Age 10-14",
    g."Total Male Population Age 15-19",
    g."Total Male Population Age 20-24",
    g."Total Male Population Age 25-29",
    g."Total Male Population Age 30-34",
    g."Total Male Population Age 35-39",
    g."Total Male Population Age 40-44",
    g."Total Male Population Age 45-49",
    g."Total Male Population Age 50-54",
    g."Total Male Population Age 55-59",
    g."Total Male Population Age 60-64",
    g."Total Male Population Age 65-69",
    g."Total Male Population Age 70-74",
    g."Total Male Population Age 75-79",
    g."Total Male Population Age 80+",
    g."Total Female Population Aged 0-4 (2021-2022)",
    g."Total Female Population Aged 5-9 (2021-2022)",
    g."Total Female Population Aged 10-14 (2021-2022)",
    g."Total Female Population Aged 15-19 (2021-2022)",
    g."Total Female Population Aged 20-24 (2021-2022)",
    g."Total Female Population Aged 25-29 (2021-2022)",
    g."Total Female Population Aged 30-34 (2021-2022)",
    g."Total Female Population Aged 35-39 (2021-2022)",
    g."Total Female Population Aged 40-44 (2021-2022)",
    g."Total Female Population Aged 45-49 (2021-2022)",
    g."Total Female Population Aged 50-54 (2021-2022)",
    g."Total Female Population Aged 55-59 (2021-2022)",
    g."Total Female Population Aged 60-64 (2021-2022)",
    g."Total Female Population Aged 65-69 (2021-2022)",
    g."Total Female Population Aged 70-74 (2021-2022)",
    g."Total Female Population Aged 75-79 (2021-2022)",
    g."Total Female Population Aged 80-84 (2021-2022)",
    g."Total Female Population Aged 85-89 (2021-2022)",
    g."Total Female Population Aged 90-94 (2021-2022)",
    g."Total Female Population Aged 95-99 (2021-2022)",
    g."Total Female Population Aged 100+ (2021-2022)",
    g."Total Male Population Aged 0-4 (2021-2022)",
    g."Total Male Population Aged 5-9 (2021-2022)",
    g."Total Male Population Aged 10-14 (2021-2022)",
    g."Total Male Population Aged 15-19 (2021-2022)",
    g."Total Male Population Aged 20-24 (2021-2022)",
    g."Total Male Population Aged 25-29 (2021-2022)",
    g."Total Male Population Aged 30-34 (2021-2022)",
    g."Total Male Population Aged 35-39 (2021-2022)",
    g."Total Male Population Aged 40-44 (2021-2022)",
    g."Total Male Population Aged 45-49 (2021-2022) ",
    g."Total Male Population Aged 50-54 (2021-2022) ",
    g."Total Male Population Aged 55-59 (2021-2022) ",
    g."Total Male Population Aged 60-64 (2021-2022) ",
    g."Total Male Population Aged 65-69 (2021-2022) ",
    g."Total Male Population Aged 70-74 (2021-2022) ",
    g."Total Male Population Aged 75-79 (2021-2022) ",
    g."Total Male Population Aged 80-84 (2021-2022) ",
    g."Total Male Population Aged 85-89 (2021-2022) ",
    g."Total Male Population Aged 90-94 (2021-2022) ",
    g."Total Male Population Aged 95-99 (2021-2022) ",
    g."Total Male Population Aged 100+ (2021-2022) ",
    g."WorldPop - Population Weighted Density - Geometric Mean",
    e."Event ID",
    e."Event Name",
    e."Disaster Group",
    e."Disaster Sub Group",
    e."Disaster Type",
    e."Disaster Sub Type",
    e."Administrative Name - Level 0",
    e."Administrative Name List - Level 1",
    e."Administrative Name List - Level 2",
    e."Event End Date",
    e."Total Deaths",
    e."Number Injured",
    e."Number Affected",
    e."Number Homeless",
    e."Total Affected",
    e."Total Damage, Adjusted (USD)",
    e."Reconstruction Costs, Adjusted (USD)",
    e."AID Contribution (USD)",
    e."Event - Disaster Internal Displacements",
    e."Source",
    e."Metadata",
    e."United States Geological Survey (USGS) Earthquake ID",
    e."GLIDE number",
    e."Darthmouth Flood Observatory (DFO) Event ID",
    e."Local Identifier",
    e."IFRC Appeal ID",
    e."Government Assigned Identifier"
   FROM mv_geospatial_combined g
     FULL JOIN events_viz e ON g.gid::bpchar = e."ISO3 (GADM - GID)" AND g.date = e."Date"
WITH DATA;


CREATE INDEX idx_country_level_event_merged_geospatial_data_viz_date
    ON public.country_level_event_merged_geospatial_data_viz USING btree
    ("Date")
    TABLESPACE pg_default;
CREATE INDEX idx_country_level_event_merged_geospatial_data_viz_gid
    ON public.country_level_event_merged_geospatial_data_viz USING btree
    ("ISO3 (GADM - GID)" COLLATE pg_catalog."default")
    TABLESPACE pg_default;
CREATE INDEX idx_country_level_event_merged_geospatial_data_viz_gid_date
    ON public.country_level_event_merged_geospatial_data_viz USING btree
    ("ISO3 (GADM - GID)" COLLATE pg_catalog."default", "Date")
    TABLESPACE pg_default;